<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, intial-scale=1.0">
    <title>Farmers.gov Design System Test</title>
    <link rel="stylesheet" href="dist/css/main.min.css">
    <script src="js/smoothscroll-polyfill.js" charset="utf-8"></script>
    <style media="screen">

      .demo-block {
        outline: 1px solid blue;
        font-size: 2rem;
      }
      .box-accordion {
        width: 34.6rem;
        margin: 1rem 1rem;
      }
      h3 {
        margin: 0;
      }
      .card-accordion {
        /* outline: 1px solid lime; */
        box-shadow: 0 1px 4px 0 #BBBBBB;
        padding: 3.2rem 3.2rem 2.4rem 3.2rem;
        margin: 1rem;
        min-height: 26rem;
        overflow: hidden;
      }
      .card-accordion-content {
        height: 26rem;
      }
      .card-accordion-content.show {
        height: auto;
      }
      .card-accordion-toggle {
        position: relative;
        height: 7.2rem;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        bottom: -2.4rem;
        background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,.95), rgba(255,255,255,1), rgba(255,255,255,1), rgba(255,255,255,1));
      }

      .card-accordion-show-more {
        color: #006546;
        font-weight: bold;
        padding-right: 2rem;
        background-size: 1.2rem;
        background-repeat: no-repeat;
        background-position: right center;
        background-image: url('./img/accordion-card-plus.svg');
      }
      .card-accordion-show-less {
        background-image: url('./img/accordion-card-minus.svg');
      }
      .box-accordion-top {
        min-height: 15.2rem;
        padding: 2.4rem;
        box-shadow: 0 1px 4px 0 #BBBBBB;
        background-image: url('./img/box-accordion-plus.svg');
        background-size: 3.2rem;
        background-repeat: no-repeat;
        background-position: 2.4rem 14.4rem;
      }
      .box-accordion-top:hover {
        cursor: pointer;
      }

      .box-accordion-top[aria-expanded="true"] {
        background-color: #49A564;
        background-image: url('./img/box-accordion-minus.svg');
      }

      .box-accordion-top[aria-expanded="true"] .headline-3 {
        color: #FFFFFF;
      }

      .box-accordion-top.Accordion-trigger.focus {
        outline-color: -webkit-focus-ring-color;
        outline-style: auto;
        outline-width: 3px;
        outline-offset: 5px;
      }

      .Accordion-panel {
        padding: 3.2rem 2.4rem;
        position: relative;
        background: #ffffff;
        box-shadow: 0px 4px 6px -3px #BBBBBB;
        border-top: .8rem solid #49A564;
      }

      .Accordion-panel p {
        margin: 0;
      }
      .down-arrow{
        display: none;
        visibility: hidden;
      }

      .box-accordion-top[aria-expanded="true"] .down-arrow {
        /* outline: 1px solid red; */
        display: block;
        visibility: visible;
        background: #49A564;
        width: 4rem;
        height: 4rem;
        position: relative;
        top: 13.1rem;
        left: 2rem;
        transform: rotate(45deg);
        z-index: 1;
      }

    </style>
  </head>
  <body>

      <div class="demo-block container">
        <!-- Accordion Configuration Options

        data-allow-toggle
          Allow for each toggle to both open and close its section. Makes it possible for all sections to be closed. Assumes only one section may be open.

        data-allow-multiple
          Allow for multiple accordion sections to be expanded at the same time. Assumes data-allow-toggle otherwise the toggle on open sections would be disabled.
        __________

        Ex:
          <div id="accordionGroup" class="Accordion" data-allow-multiple>

          <div id="accordionGroup" class="Accordion" data-allow-toggle>
        -->
        <div id="accordionGroup" class="Accordion row" data-allow-toggle>
          <div class="box-accordion ">
            <div  class="box-accordion-top Accordion-trigger"
                  tabindex="0"
                  aria-expanded="false"
                  aria-controls="sect1"
                  id="accordion1id">
              <h3>
                  <span class="Accordion-title headline-3">
                    Personal Information
                    <span class="Accordion-icon"></span>
                  </span>
              </h3>
              <div class="down-arrow"></div>
            </div>
            <div  id="sect1"
                  role="region"
                  aria-labelledby="accordion1id"
                  class="Accordion-panel"
                  hidden="">
                <p>
                  Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                </p>
            </div>
          </div>
          <div class="box-accordion ">
            <div  class="box-accordion-top Accordion-trigger"
                  tabindex="0"
                  aria-expanded="false"
                  aria-controls="sect2"
                  id="accordion2id">
              <h3>
                <span class="Accordion-title headline-3">
                  Billing Address
                  <span class="Accordion-icon"></span>
                </span>
              </h3>
              <div class="down-arrow"></div>
            </div>
            <div id="sect2"
                  role="region"
                  aria-labelledby="accordion2id"
                  class="Accordion-panel"
                  hidden="">
                  <p>
                    LorBilling Addresseiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                  </p>
            </div>
          </div>
          <div class="box-accordion ">
            <div class="box-accordion-top Accordion-trigger"
                  tabindex="0"
                  aria-expanded="false"
                  aria-controls="sect3"
                  id="accordion3id">
              <h3>
                <span class="Accordion-title headline-3">
                  Shipping Address
                  <span class="Accordion-icon"></span>
                </span>
              </h3>
              <div class="down-arrow"></div>
            </div>
            <div id="sect3"
                role="region"
                aria-labelledby="accordion3id"
                class="Accordion-panel"
                hidden="">
                <p>
                  LoreShipping Addresstur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                </p>
            </div>
          </div>
        </div>

        <div id="accordionFull" class="Card-Accordion row">
          <!-- <div class="medium-12"> -->
            <div class="card-accordion" tabindex="0">
              <div class="card-accordion-content">
                <p>
                  General Kenobi, years ago you served my father in the Clone Wars. Now he begs you to help him in his struggle against the Empire. I regret that I am unable to present my father's request to you in person, but my ship has fallen under attack and I'm afraid my mission to bring you to Alderaan has failed. I have placed information vital to the survival of the Rebellion into the memory systems of this R2 unit. My father will know how to retrieve it. You must see this droid safely delivered to him on Alderaan. This is our most desperate hour. Help me, Obi-Wan Kenobi, you're my only hope.

                  Stretch out with your feelings. You see, you can do it. I call it luck. In my experience, there's no such thing as luck. Look, going good against remotes is one thing. Going good against the living? That's something else. Looks like we're coming up on Alderaan. You know, I did feel something. I could almost see the remote. That's good. You have taken your first step into a larger world.

                  Lord Vader, I should have known. Only you could be so bold. The Imperial Senate will not sit for this, when they hear you've attacked a diplomatic... Don't play games with me, Your Highness. You weren't on any mercy mission this time. You passed directly through a restricted system. Several transmissions were beamed to this ship by Rebel spies. I want to know what happened to the plans they sent you. I don't know what you're talking about. I'm a member of the Imperial Senate on a diplomatic mission to Alderaan... You're a part of the Rebel Alliance...and a traitor. Take her away!

                  Wake up! Wake up! We're doomed. Do you think they'll melt us down? Don't shoot! Don't shoot! Will this never end? Luke, tell Owen that if he gets a translator to be sure it speaks Bocce. It looks like we don't have much of a choice but I'll remind him. I have no need for a protocol droid. Sir -- not in an environment such as this -- that's why I've also been programmed for over thirty secondary functions that... What I really need is a droid that understands the binary language of moisture vaporators. Vaporators! Sir -- My first job was programming binary load lifter...very similar to your vaporators. You could say... Do you speak Bocce? Of course I can, sir. It's like a second language for me...I'm as fluent in... All right shut up! I'll take this one.

                  You must learn the ways of the Force if you're to come with me to Alderaan. Alderaan? I'm not going to Alderaan. I've got to go home. It's late, I'm in for it as it is. I need your help, Luke. She needs your help. I'm getting too old for this sort of thing. I can't get involved! I've got work to do! It's not that I like the Empire. I hate it! But there's nothing I can do about it right now. It's such a long way from here. That's your uncle talking. Oh, God, my uncle. How am I ever going to explain this?
                </p>
              </div>
              <div class="card-accordion-toggle">
                <a href="javascript:undefined;" class="card-accordion-show-more" tabindex="-1">Show More</a>
              </div>
            </div>
          <!-- </div> -->
        </div>
      </div>

    <script type="text/javascript">
    /*
    *   This content is licensed according to the W3C Software License at
    *   https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document
    *
    *   Simple accordion pattern example
    */

    'use strict';

    function panelWidthFix(accordionBlock, accordionTarget) {
      const targetPanel = accordionTarget.nextSibling.nextElementSibling;
      const offset =  10 + (accordionTarget.parentElement.offsetLeft - accordionBlock.offsetLeft) *-1 + 'px';

      targetPanel.style.marginLeft = offset;
      targetPanel.style.width = `${accordionBlock.offsetWidth - 65}px`;
    }

    Array.prototype.slice.call(document.querySelectorAll('.Accordion')).forEach(function (accordion) {
      // Allow for multiple accordion sections to be expanded at the same time
      var allowMultiple = false;    // we don't want multiple accordion sections to be expanded at the same time

      // Allow for each toggle to both open and close individually
      var allowToggle = accordion.hasAttribute('data-allow-toggle');

      // Create the array of toggle elements for the accordion group
      var triggers = [...accordion.querySelectorAll('.Accordion-trigger')];
      var panels = [...accordion.querySelectorAll('.Accordion-panel')];


      triggers.map( target => {
        panelWidthFix(accordion, target);
      })

      accordion.addEventListener('click', function (event) {
        var target = event.target;
        target.parentElement.parentElement.classList.contains('Accordion-trigger') ?
                                       target = target.parentElement.parentElement :
                      target.parentElement.classList.contains('Accordion-trigger') ?
                                                     target = target.parentElement :
                                                                                 ''; // Kind of a hack to set target element correctly


        if (target.classList.contains('Accordion-trigger') ) {
          // Check if the current toggle is expanded.
          var isExpanded = target.getAttribute('aria-expanded') == 'true';
          var active = accordion.querySelector('[aria-expanded="true"]');

          // without allowMultiple, close the open accordion
          if (!allowMultiple && active && active !== target) {
            // Set the expanded state on the triggering element
            active.setAttribute('aria-expanded', 'false');
            // Hide the accordion sections, using aria-controls to specify the desired section
            document.getElementById(active.getAttribute('aria-controls')).setAttribute('hidden', '');

            // When toggling is not allowed, clean up disabled state
            if (!allowToggle) {
              active.removeAttribute('aria-disabled');
            }
          }

          if (!isExpanded) {
            // Set the expanded state on the triggering element
            target.setAttribute('aria-expanded', 'true');
            // Hide the accordion sections, using aria-controls to specify the desired section
            document.getElementById(target.getAttribute('aria-controls')).removeAttribute('hidden');

            // If toggling is not allowed, set disabled state on trigger
            if (!allowToggle) {
              target.setAttribute('aria-disabled', 'true');
            }
          }
          else if (allowToggle && isExpanded) {
            // Set the expanded state on the triggering element
            target.setAttribute('aria-expanded', 'false');
            // Hide the accordion sections, using aria-controls to specify the desired section
            document.getElementById(target.getAttribute('aria-controls')).setAttribute('hidden', '');
          }

          event.preventDefault();
        }

        let activePanel = panels.filter( el => !el.hasAttribute('hidden'))[0];
        activePanel ? activePanel.scrollIntoView({behavior: "smooth"}) : '';
      });

      // Bind keyboard behaviors on the main accordion container
      accordion.addEventListener('keydown', function (event) {
        var target = event.target;
        var key = event.which.toString();

        var isExpanded = target.getAttribute('aria-expanded') == 'true';
        var allowToggle = (allowMultiple) ? allowMultiple : accordion.hasAttribute('data-allow-toggle');

        // 33 = Page Up, 34 = Page Down
        var ctrlModifier = (event.ctrlKey && key.match(/33|34/));

        // Is this coming from an accordion header?
        if (target.classList.contains('Accordion-trigger')) {
          // Up/ Down arrow and Control + Page Up/ Page Down keyboard operations
          // 38 = Up, 40 = Down
          if (key.match(/38|40/) || ctrlModifier) {
            var index = triggers.indexOf(target);
            var direction = (key.match(/34|40/)) ? 1 : -1;
            var length = triggers.length;
            var newIndex = (index + length + direction) % length;

            triggers[newIndex].focus();

            event.preventDefault();
          }
          else if (key.match(/35|36/)) {
            // 35 = End, 36 = Home keyboard operations
            switch (key) {
              // Go to first accordion
              case '36':
                triggers[0].focus();
                break;
                // Go to last accordion
              case '35':
                triggers[triggers.length - 1].focus();
                break;
            }
            event.preventDefault();

          } else if (key.match(/32|13/)) {
            // 13 = Enter, 32 = Space keyboard operations
            target.click();
          }

        }
      });

      // These are used to style the accordion when one of the buttons has focus
      accordion.querySelectorAll('.Accordion-trigger').forEach(function (trigger) {

        trigger.addEventListener('focus', function (event) {
          accordion.classList.add('focus');
          event.target.classList.add('focus');
        });

        trigger.addEventListener('blur', function (event) {
          accordion.classList.remove('focus');
          event.target.classList.remove('focus');
        });

      });

      // Minor setup: will set disabled state, via aria-disabled, to an
      // expanded/ active accordion which is not allowed to be toggled close
      if (!allowToggle) {
        // Get the first expanded/ active accordion
        var expanded = accordion.querySelector('[aria-expanded="true"]');

        // If an expanded/ active accordion is found, disable
        if (expanded) {
          expanded.setAttribute('aria-disabled', 'true');
        }
      }

      });

      window.addEventListener('resize', () => {
        [...document.querySelectorAll('.Accordion')].map( accordion => {
          [...accordion.querySelectorAll('.Accordion-trigger')].map( target => {
            panelWidthFix(accordion, target)
          })
        })
    })

    let accordion_card_array = [...document.querySelectorAll('.Card-Accordion')];
    accordion_card_array.map( cardAccordion => {
      cardAccordion.addEventListener('click', (evt) => {
        var target = evt.target;
        target.parentElement.parentElement.parentElement.classList.contains('Card-Accordion') ?
                                    target = target.parentElement.parentElement.parentElement :
                      target.parentElement.parentElement.classList.contains('Card-Accordion') ?
                                                  target = target.parentElement.parentElement :
                                    target.parentElement.classList.contains('Card-Accordion') ?
                                                                target = target.parentElement :
                                                                                            '';

        target.querySelector('.card-accordion-content').classList.toggle('show')
        target.querySelector('.card-accordion-toggle > a').classList.toggle('card-accordion-show-less')
        if (target.querySelector('.card-accordion-content').classList.contains('show')) {

          target.querySelector('.card-accordion-content.show').scrollIntoView({behavior: "smooth"})
          target.querySelector('.card-accordion-toggle > a').innerHTML = 'Show Less'
        } else {
          target.querySelector('.card-accordion-toggle > a').innerHTML = 'Show More'
        }
      })

      cardAccordion.addEventListener('keydown', (event) => {
        var target = event.target;
        var key = event.which.toString();
        if (key.match(/32|13/)) {
          cardAccordion.click();
        }
      })
    })

    </script>
  </body>
</html>
